{% extends "navigation/base.html" %}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <div class="container-fluid"> <!-- Зміна на container-fluid -->

        {% block content %}
        <h1 class="text-center my-4">Довідник дизайни плиток</h1>
        {% include "tiles/filter_form.html" %}
    </div>
    <div id="tilesContainer">
        {% include "tiles/tiles_partial.html" %}
    </div>
        {% endblock %}        
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.querySelectorAll('.dropdown-submenu .dropdown-toggle').forEach(function (element) {
        element.addEventListener('click', function (e) {
            e.preventDefault();
            e.stopPropagation();
            const submenu = this.nextElementSibling;
            if (submenu) submenu.classList.toggle('show');
        });
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
    const filters = {
        archived: localStorage.getItem('archived') || '',
        design: localStorage.getItem('design') || '',
        collection: localStorage.getItem('collection') || ''
    };

    // Заповнюємо фільтри зі сховища
    document.getElementById('archived').value = filters.archived;
    document.getElementById('design').value = filters.design;
    document.getElementById('collection').value = filters.collection;

    // Подія при натисканні кнопки
    document.getElementById('applyFilters').addEventListener('click', () => {
        filters.archived = document.getElementById('archived').value;
        filters.design = document.getElementById('design').value;
        filters.collection = document.getElementById('collection').value;

        // Кешуємо
        localStorage.setItem('archived', filters.archived);
        localStorage.setItem('design', filters.design);
        localStorage.setItem('collection', filters.collection);

        fetchData(filters);
    });

    // Автоматичний запит при завантаженні
    fetchData(filters);
    });

    function fetchData(filters) {
    const queryString = new URLSearchParams(filters).toString();
    fetch(`/api/filter-products/?${queryString}`)
        .then(res => res.json())
        .then(data => {
        const container = document.getElementById('products');
        container.innerHTML = '<table><tr><th>Назва</th><th>Дизайн</th><th>Колекція</th></tr>' +
            data.results.map(prod =>
            `<tr><td>${prod.name}</td><td>${prod.design}</td><td>${prod.collection}</td></tr>`
            ).join('') +
            '</table>';
        });
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
  $(document).ready(function() {
      $('.select2').select2({
          width: 'resolve',
          placeholder: "Виберіть значення",
          allowClear: true
      });
  });
</script>
</body>
</html>
