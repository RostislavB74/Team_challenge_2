<!DOCTYPE html>
   <html lang="uk">
   <head>
       <meta charset="UTF-8">
       <meta name="viewport" content="width=device-width, initial-scale=1.0">
       <title>Звіт зміни</title>
       <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
       <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
       <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
       <style>
           table { width: 100%; border-collapse: collapse; margin-top: 20px; }
           th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
           th { background-color: #f2f2f2; }
           .btn { margin: 5px; }
           .selected { background-color: #e0e0e0; }
       </style>
       <script>
           let selectedRowId = null;

           function selectRow(rowId) {
               $('.table tbody tr').removeClass('selected');
               $(`#row_${rowId}`).addClass('selected');
               selectedRowId = rowId;
           }

           function addRow() {
               window.location.href = `/shift-reports/{{ shift_doc.doc_id }}/add-row/`;
           }

           function editRow() {
               if (selectedRowId) {
                   window.location.href = `/shift-reports/{{ shift_doc.doc_id }}/edit-row/${selectedRowId}/`;
               } else {
                   alert("Виберіть рядок для редагування");
               }
           }

           function deleteRow() {
               if (selectedRowId) {
                   if (confirm("Ви впевнені, що хочете видалити рядок?")) {
                       window.location.href = `/shift-reports/{{ shift_doc.doc_id }}/delete-row/${selectedRowId}/`;
                   }
               } else {
                   alert("Виберіть рядок для видалення");
               }
           }

           function saveReport() {
               window.location.href = '/shift-reports/';
           }

           function printReport() {
               window.location.href = window.location.pathname + 'print/';
           }
       </script>
   </head>
   <body>
       <div class="container">
           <h1>Звіт зміни {{ shift_doc.doc_number }}</h1>
           {% if error %}
               <div class="alert alert-danger">{{ error }}</div>
           {% else %}
               <p>Дата: {{ shift_doc.doc_date|date:"Y-m-d" }}</p>
               <p>Початок: {{ shift_doc.begin_time|time:"H:i" }}</p>
               <p>Кінець: {{ shift_doc.end_time|time:"H:i" }}</p>
               <p>Лінія: {{ shift_doc.line_name }}</p>
               <p>Майстер: {{ shift_doc.foreman_name }}</p>
               <p>Статус: {% if shift_doc.draft %}Чернетка{% else %}Підтверджено{% endif %}</p>
               <table class="table">
                   <thead>
                       <tr>
                           <th>№ п/п</th>
                           <th>Дизайн</th>
                           <th>Сорт</th>
                           <th>Брак</th>
                           <th>Кількість</th>
                           <th>Одиниця</th>
                           <th>Коробки</th>
                           <th>Палети</th>
                       </tr>
                   </thead>
                   <tbody>
                       {% for row in shift_rows %}
                           <tr id="row_{{ row.row_id }}" onclick="selectRow({{ row.row_id }})">
                               {% comment %} <td>{{ row.row_id }}</td> {% endcomment %}
                               <td>{{ forloop.counter }}</td>
                               <td>{{ row.design_name }}</td>
                               <td>{{ row.quality }}</td>
                               <td>{{ row.is_defect|yesno:"Так,Ні" }}</td>
                               <td>{{ row.amount|default:0|floatformat:"2" }}</td>
                               <td>{{ row.unit_alias|default:"" }}</td>
                               <td>{{ row.box_amount|default:0|floatformat:"2" }}</td>
                               <td>{{ row.package_amount|default:0|floatformat:"2" }}</td>
                           </tr>
                       {% empty %}
                           <tr><td colspan="9">Немає даних</td></tr>
                       {% endfor %}
                   </tbody>
               </table>
               <h2>Простої</h2>
               <table class="table">
                   <thead>
                       <tr>
                           <th>№ п/п</th>
                           <th>Піч</th>
                           <th>Простої, хв.</th>
                           <th>Тип простою</th>
                           <th>Причина простою</th>
                           <th>Коментарій</th>
                       </tr>
                   </thead>
                   <tbody>
                       {% for downtime in downtimes %}
                           <tr>
                               <td>{{ forloop.counter }}</td>
                               {% comment %} <td>{{ downtime.row_id }}</td> {% endcomment %}
                               <td>{{ downtime.kiln_name }}</td>
                               <td>{{ downtime.amount|floatformat:"2" }}</td>
                               <td>{{downtime.stoppage_type_name}}</td>
                               <td>{{downtime.stoppage_cause}}</td>
                               <td>{{ downtime.comment }}</td>
                           </tr>
                       {% empty %}
                           <tr><td colspan="4">Немає простоїв</td></tr>
                       {% endfor %}
                   </tbody>
               </table>
               {% if can_edit %}
                   <button class="btn btn-primary" onclick="addRow()">Додати рядок</button>
                   <button class="btn btn-warning" onclick="editRow()">Редагувати рядок</button>
                   <button class="btn btn-danger" onclick="deleteRow()">Видалити рядок</button>
               {% endif %}
               <button class="btn btn-success" onclick="saveReport()">Зберегти звіт</button>
               <button class="btn btn-info" onclick="printReport()">Друк</button>
           {% endif %}
       </div>
   </body>
   </html>
